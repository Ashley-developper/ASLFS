<!doctypehtml><html lang=en><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"><title>AI Translator - Professional Translation Tool</title><style>:root{--bg:#0f0f1a;--bg-secondary:#1a1a2e;--text:#f8f9fa;--text-secondary:#a0aec0;--accent-a:#4fd1c7;--accent-b:#ff6b9d;--accent-c:#9f7aea;--user-bg:rgba(79, 209, 199, 0.15);--ai-bg:rgba(159, 122, 234, 0.15);--border:rgba(255, 255, 255, 0.1);--success:#38b2ac;--warning:#ed8936;--error:#fc8181}*{box-sizing:border-box;margin:0;padding:0;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent}body{font-family:-apple-system,BlinkMacSystemFont,"SF Pro","Segoe UI","Microsoft YaHei",sans-serif;background:linear-gradient(135deg,#0f0f1a 0,#1a1a2e 100%);color:var(--text);height:100vh;display:flex;flex-direction:column;overflow:hidden;touch-action:pan-y}html{touch-action:manipulation}.auth-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#0f0f1a 0,#1a1a2e 100%);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:3000;padding:20px;text-align:center}.auth-screen.hidden{display:none}.auth-container{max-width:400px;width:100%}.auth-step{display:none;animation:fadeIn .5s ease}.auth-step.active{display:flex;flex-direction:column;align-items:center;gap:30px}@keyframes fadeIn{from{opacity:0}to{opacity:1}}.auth-icon{font-size:80px;animation:float 3s ease-in-out infinite}@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-20px)}}.auth-title{font-size:28px;font-weight:700;color:var(--text);letter-spacing:-.5px}.auth-subtitle{font-size:16px;color:var(--text-secondary);line-height:1.6}.auth-code{font-size:14px;color:var(--accent-a);font-family:'Courier New',monospace;letter-spacing:2px;padding:15px 20px;background:rgba(79,209,199,.1);border-radius:10px;border:1px solid var(--accent-a);margin:20px 0}.auth-button{padding:16px 32px;background:linear-gradient(135deg,var(--accent-a),var(--accent-b));color:#fff;border:none;border-radius:12px;font-size:16px;font-weight:600;cursor:pointer;transition:all .3s;width:100%}.auth-button:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(79,209,199,.3)}.auth-button:active{transform:translateY(0)}.auth-indicator{display:flex;gap:12px;justify-content:center;margin:20px 0}.auth-dot{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,.2);transition:all .3s}.auth-dot.active{background:var(--accent-a);transform:scale(1.3)}.loading-spinner{width:40px;height:40px;border:3px solid rgba(79,209,199,.2);border-top-color:var(--accent-a);border-radius:50%;animation:spin 1s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}.terms-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#0f0f1a 0,#1a1a2e 100%);display:flex;flex-direction:column;z-index:2000;padding:0}.terms-screen.hidden{display:none}.terms-header{padding:20px;border-bottom:1px solid var(--border);background:rgba(79,209,199,.05)}.terms-title{font-size:24px;font-weight:700;color:var(--accent-a);display:flex;align-items:center;gap:10px;margin-bottom:8px}.terms-subtitle{font-size:13px;color:var(--text-secondary)}.terms-content{flex:1;overflow-y:auto;padding:25px 20px;-webkit-overflow-scrolling:touch}.terms-section{margin-bottom:25px}.terms-section-title{font-size:16px;font-weight:600;color:var(--accent-a);margin-bottom:12px;display:flex;align-items:center;gap:8px}.terms-section-content{font-size:14px;color:var(--text-secondary);line-height:1.8;padding-left:28px}.terms-section-content strong{color:var(--text)}.terms-actions{padding:20px;border-top:1px solid var(--border);display:flex;gap:12px;background:rgba(26,26,46,.8);-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px)}.terms-agree-btn{flex:1;padding:14px;background:linear-gradient(135deg,var(--accent-a),var(--accent-b));color:#fff;border:none;border-radius:10px;font-weight:600;cursor:pointer;transition:all .3s;font-size:15px}.terms-agree-btn:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(79,209,199,.3)}.terms-agree-btn:active{transform:translateY(0)}.mom-header{padding:15px 20px;background:linear-gradient(90deg,rgba(79,209,199,.1),rgba(159,122,234,.1));border-bottom:2px solid var(--accent-a);display:flex;justify-content:space-between;align-items:center;position:relative;z-index:10;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.header-content{display:flex;align-items:center;gap:15px;flex:1;overflow:hidden}.mom-title{font-size:18px;font-weight:700;color:var(--accent-a);display:flex;align-items:center;gap:8px;white-space:nowrap}.mom-subtitle{font-size:12px;color:var(--text-secondary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.lang-selector{display:flex;align-items:center;gap:10px;flex-wrap:wrap}.lang-select{background:rgba(255,255,255,.08);color:var(--text);border:1px solid var(--border);padding:10px 14px;border-radius:12px;font-size:14px;min-width:120px;outline:0;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);cursor:pointer;transition:all .3s;-webkit-appearance:none;appearance:none}.lang-select:focus,.lang-select:hover{border-color:var(--accent-a);background:rgba(255,255,255,.12)}.lang-select:focus{box-shadow:0 0 0 3px rgba(79,209,199,.2)}.swap-btn{background:rgba(255,255,255,.1);border:1px solid var(--border);color:var(--text);width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s;flex-shrink:0}.swap-btn:hover{background:var(--accent-a);color:#000;transform:rotate(180deg) scale(1.1)}.settings-btn{background:rgba(255,255,255,.1);border:1px solid var(--border);color:var(--text);width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:16px;transition:all .3s;flex-shrink:0}.settings-btn:hover{background:var(--accent-b);color:#fff;transform:scale(1.1)}.settings-panel{position:fixed;right:-320px;top:0;width:320px;height:100vh;background:linear-gradient(135deg,rgba(26,26,46,.98) 0,rgba(31,41,55,.98) 100%);-webkit-backdrop-filter:blur(30px);backdrop-filter:blur(30px);padding:20px;border-left:2px solid var(--accent-a);z-index:100;transition:right .4s cubic-bezier(.4, 0, .2, 1);overflow-y:auto;display:flex;flex-direction:column;gap:20px;box-shadow:-5px 0 30px rgba(0,0,0,.5)}.settings-panel.active{right:0}.panel-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.panel-title{font-size:16px;color:var(--accent-a);display:flex;align-items:center;gap:8px}.close-btn{background:rgba(255,255,255,.1);border:none;color:var(--text);width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s;flex-shrink:0}.close-btn:hover{background:var(--error);transform:scale(1.1)}.setting-group{background:rgba(255,255,255,.05);border-radius:16px;padding:18px;border:1px solid var(--border);transition:all .3s}.setting-group:hover{background:rgba(255,255,255,.08);border-color:var(--accent-a)}.setting-group h3{font-size:14px;color:var(--accent-a);margin-bottom:15px;text-transform:uppercase;letter-spacing:1px;display:flex;align-items:center;gap:8px}.setting-item{margin-bottom:15px}.setting-item:last-child{margin-bottom:0}.setting-item label{display:block;margin-bottom:8px;font-size:14px;color:var(--text);font-weight:500}.shanbay-section{background:linear-gradient(135deg,rgba(79,209,199,.1),rgba(255,107,157,.1));border:1px solid var(--accent-a);margin-top:10px}.shanbay-btn{width:100%;padding:14px;border-radius:12px;border:none;background:linear-gradient(90deg,var(--accent-a),var(--accent-b));color:#fff;font-weight:600;font-size:15px;cursor:pointer;transition:all .3s;display:flex;align-items:center;justify-content:center;gap:10px;margin-top:10px}.shanbay-btn:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(79,209,199,.3)}.shanbay-btn:active{transform:translateY(0)}.shanbay-btn:disabled{opacity:.5;cursor:not-allowed;transform:none;box-shadow:none}.chat-container{flex:1;overflow-y:auto;padding:20px;padding-bottom:10px;display:flex;flex-direction:column;gap:15px;position:relative;background:linear-gradient(to bottom,transparent,rgba(26,26,46,.3));-webkit-overflow-scrolling:touch}.message{max-width:85%;padding:18px;border-radius:20px;position:relative;animation:fadeIn .4s ease;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid transparent;transition:all .3s;word-break:break-word;overflow-wrap:break-word}@keyframes fadeIn{from{opacity:0;transform:translateY(15px)}to{opacity:1;transform:translateY(0)}}.message.user{align-self:flex-end;background:linear-gradient(135deg,var(--user-bg) 0,rgba(79,209,199,.1) 100%);border-bottom-right-radius:8px;border-left:4px solid var(--accent-a);border-color:var(--border)}.message.user:hover{border-color:var(--accent-a);box-shadow:0 5px 20px rgba(79,209,199,.2)}.message.ai{align-self:flex-start;background:linear-gradient(135deg,var(--ai-bg) 0,rgba(159,122,234,.1) 100%);border-bottom-left-radius:8px;border-right:4px solid var(--accent-c);border-color:var(--border)}.message.ai:hover{border-color:var(--accent-c);box-shadow:0 5px 20px rgba(159,122,234,.2)}.message-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;font-size:12px;color:var(--text-secondary)}.message-actions{display:flex;gap:8px}.action-btn{background:rgba(255,255,255,.1);border:1px solid var(--border);color:var(--text-secondary);width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:12px;transition:all .3s}.action-btn:hover{background:var(--accent-a);color:#000;transform:scale(1.1)}.lang-badge{padding:4px 10px;border-radius:12px;font-size:11px;font-weight:600;letter-spacing:.5px;text-transform:uppercase}.lang-badge.source{background:var(--accent-a);color:#000}.lang-badge.target{background:var(--accent-c);color:#000}.message-content{font-size:16px;line-height:1.6;white-space:pre-wrap;word-break:break-word}.vocabulary-section{margin-top:18px;padding-top:18px;border-top:2px dashed rgba(255,255,255,.15);position:relative}.vocabulary-section::before{content:"ğŸ“š";position:absolute;top:-12px;left:50%;transform:translateX(-50%);background:var(--bg);padding:0 10px}.vocabulary-title{font-size:14px;color:var(--accent-a);margin-bottom:12px;display:flex;align-items:center;gap:8px;font-weight:600}.vocabulary-list{display:flex;flex-wrap:wrap;gap:10px}.vocab-word{background:rgba(255,255,255,.1);border:1px solid var(--border);padding:8px 14px;border-radius:10px;font-size:14px;cursor:pointer;transition:all .3s;display:flex;align-items:center;gap:8px;position:relative;overflow:hidden}.vocab-word::before{content:"";position:absolute;top:0;left:0;right:0;height:2px;background:var(--accent-a);transform:translateX(-100%);transition:transform .3s}.vocab-word:hover{background:rgba(255,255,255,.15);transform:translateY(-3px);box-shadow:0 5px 15px rgba(0,0,0,.2)}.vocab-word:hover::before{transform:translateX(0)}.vocab-word.difficulty-basic{border-color:#4fd1c7}.vocab-word.difficulty-intermediate{border-color:#ffb347}.vocab-word.difficulty-advanced{border-color:#ff6b9d}.level-tag{font-size:10px;padding:2px 8px;border-radius:10px;font-weight:600}.level-basic{background:rgba(79,209,199,.2);color:#4fd1c7}.level-intermediate{background:rgba(255,179,71,.2);color:#ffb347}.level-advanced{background:rgba(255,107,157,.2);color:#ff6b9d}.message-time{font-size:11px;opacity:.7;margin-top:8px;text-align:right;color:var(--text-secondary)}.input-area{padding:18px 20px;background:rgba(26,26,46,.8);border-top:1px solid var(--border);position:relative;-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px)}.input-container{display:flex;gap:12px;align-items:flex-end}.text-input-wrapper{flex:1;background:rgba(255,255,255,.08);border:1px solid var(--border);border-radius:20px;padding:14px 18px;display:flex;align-items:center;gap:12px;transition:all .3s}.text-input-wrapper:focus-within{border-color:var(--accent-a);box-shadow:0 0 0 3px rgba(79,209,199,.15);background:rgba(255,255,255,.12)}.text-input{flex:1;background:0 0;border:none;color:var(--text);font-size:16px;outline:0;resize:none;max-height:120px;min-height:24px;line-height:1.6;font-family:inherit;-webkit-user-select:text;user-select:text}.text-input::placeholder{color:var(--text-secondary)}.voice-btn{background:0 0;border:none;color:var(--text-secondary);width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:18px;transition:all .3s;flex-shrink:0}.voice-btn:hover{color:var(--accent-a);background:rgba(79,209,199,.1);transform:scale(1.1)}.voice-btn.recording{color:var(--error);animation:pulse 1.5s infinite}@keyframes pulse{0%{box-shadow:0 0 0 0 rgba(252,129,129,.4)}70%{box-shadow:0 0 0 12px rgba(252,129,129,0)}100%{box-shadow:0 0 0 0 rgba(252,129,129,0)}}.send-btn{background:linear-gradient(135deg,var(--accent-a),var(--accent-b));border:none;color:#fff;width:52px;height:52px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:20px;font-weight:700;transition:all .3s;flex-shrink:0;box-shadow:0 4px 15px rgba(79,209,199,.3);touch-action:manipulation;-webkit-user-select:none;user-select:none;padding:0;min-width:52px;min-height:52px}.send-btn:hover{transform:scale(1.1) rotate(10deg);box-shadow:0 8px 25px rgba(79,209,199,.4)}.send-btn:active{transform:scale(.95) rotate(0)}.send-btn:disabled{opacity:.5;cursor:not-allowed;transform:none;box-shadow:none}.mode-toggle{display:flex;background:rgba(255,255,255,.08);border-radius:14px;padding:6px;margin-bottom:12px;gap:6px}.mode-btn{flex:1;padding:10px 16px;border-radius:10px;border:none;background:0 0;color:var(--text-secondary);font-size:14px;cursor:pointer;transition:all .3s;display:flex;align-items:center;justify-content:center;gap:8px}.mode-btn:hover{background:rgba(255,255,255,.12)}.mode-btn.active{background:rgba(79,209,199,.2);color:var(--accent-a);font-weight:600}.status-bar{position:fixed;bottom:12px;left:50%;transform:translateX(-50%);background:rgba(26,26,46,.9);-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);padding:10px 20px;border-radius:20px;font-size:12px;color:var(--text-secondary);z-index:50;display:flex;align-items:center;gap:10px;transition:all .3s;min-width:200px;text-align:center;justify-content:center;border:1px solid var(--border);box-shadow:0 4px 15px rgba(0,0,0,.2)}.status-dot{width:8px;height:8px;border-radius:50%;background:var(--accent-a)}.status-dot.recording{background:var(--error);animation:blink 1s infinite}@keyframes blink{0%,100%{opacity:1}50%{opacity:.5}}.empty-state{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;color:var(--text-secondary);text-align:center;padding:40px 20px}.empty-state-icon{font-size:60px;margin-bottom:20px;opacity:.4;animation:float 3s ease-in-out infinite}.empty-state-text{font-size:16px;max-width:300px;line-height:1.6;color:var(--text)}.loading-dots{display:inline-flex;gap:4px}.loading-dots span{width:6px;height:6px;background:var(--accent-a);border-radius:50%;animation:bounce 1.4s infinite ease-in-out}.loading-dots span:first-child{animation-delay:-.32s}.loading-dots span:nth-child(2){animation-delay:-.16s}@keyframes bounce{0%,100%,80%{transform:scale(0)}40%{transform:scale(1)}}.switch{position:relative;display:inline-block;width:44px;height:24px}.switch input{opacity:0;width:0;height:0}.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:rgba(255,255,255,.1);transition:.4s;border-radius:24px}.slider:before{position:absolute;content:"";height:18px;width:18px;left:3px;bottom:3px;background-color:var(--text);transition:.4s;border-radius:50%}input:checked+.slider{background-color:var(--accent-a)}input:checked+.slider:before{transform:translateX(20px)}.level-select{width:100%;padding:12px;background:rgba(255,255,255,.08);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:14px;outline:0;cursor:pointer;transition:all .3s;-webkit-appearance:none;appearance:none}.level-select:hover{border-color:var(--accent-a);background:rgba(255,255,255,.12)}.level-select:focus{border-color:var(--accent-a);box-shadow:0 0 0 3px rgba(79,209,199,.15)}.tooltip{position:relative;display:inline-block}.tooltip .tooltip-text{visibility:hidden;width:220px;background:rgba(26,26,46,.95);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);color:var(--text);text-align:left;border-radius:10px;padding:12px;position:absolute;z-index:1000;bottom:125%;left:50%;transform:translateX(-50%);opacity:0;transition:opacity .3s;font-size:12px;line-height:1.5;border:1px solid var(--border);box-shadow:0 10px 30px rgba(0,0,0,.3)}.tooltip .tooltip-text strong{color:var(--accent-a);display:block;margin-bottom:5px}.tooltip:hover .tooltip-text{visibility:visible;opacity:1}.history-controls{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:15px}.history-btn{padding:12px;border-radius:10px;border:none;background:rgba(255,255,255,.1);color:var(--text);cursor:pointer;transition:all .3s;font-size:14px;display:flex;align-items:center;justify-content:center;gap:8px}.history-btn:hover{background:rgba(255,255,255,.15);transform:translateY(-2px)}.history-btn.clear{background:rgba(252,129,129,.1);color:#fc8181}.history-btn.clear:hover{background:rgba(252,129,129,.2)}.preview-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);z-index:2000;display:none;align-items:center;justify-content:center;padding:20px}.preview-modal.active{display:flex}.preview-content{background:linear-gradient(135deg,#1a1a2e 0,#2d3748 100%);border-radius:20px;padding:30px;max-width:500px;width:100%;max-height:80vh;overflow-y:auto;border:2px solid var(--accent-a);box-shadow:0 20px 60px rgba(0,0,0,.5);-webkit-overflow-scrolling:touch}.preview-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.preview-title{font-size:20px;color:var(--accent-a);display:flex;align-items:center;gap:10px}.preview-subtitle{color:var(--text-secondary);font-size:14px;margin-bottom:20px}.vocab-preview-list{display:flex;flex-direction:column;gap:10px;margin-bottom:25px;max-height:300px;overflow-y:auto;padding-right:10px;-webkit-overflow-scrolling:touch}.vocab-preview-item{display:flex;align-items:center;gap:12px;padding:12px;background:rgba(255,255,255,.05);border-radius:10px;border:1px solid var(--border);transition:all .3s}.vocab-preview-item:hover{background:rgba(255,255,255,.08);border-color:var(--accent-a)}.vocab-preview-item input[type=checkbox]{width:18px;height:18px;cursor:pointer;accent-color:var(--accent-a)}.vocab-word-preview{flex:1;font-weight:500;color:var(--text)}.vocab-difficulty{font-size:11px;padding:3px 8px;border-radius:10px;font-weight:600}.preview-actions{display:flex;gap:10px;margin-top:20px}.preview-btn{flex:1;padding:14px;border-radius:12px;border:none;font-weight:600;font-size:15px;cursor:pointer;transition:all .3s;display:flex;align-items:center;justify-content:center;gap:8px}.preview-btn.confirm{background:linear-gradient(90deg,var(--accent-a),var(--accent-b));color:#fff}.preview-btn.confirm:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(79,209,199,.3)}.preview-btn.cancel{background:rgba(255,255,255,.1);color:var(--text);border:1px solid var(--border)}.preview-btn.cancel:hover{background:rgba(255,255,255,.15)}.select-all{display:flex;align-items:center;gap:8px;margin-bottom:15px;font-size:14px;color:var(--text);cursor:pointer;padding:8px;border-radius:8px;transition:all .3s}.select-all:hover{background:rgba(255,255,255,.05)}.select-all input[type=checkbox]{width:16px;height:16px;cursor:pointer;accent-color:var(--accent-a)}@media (max-width:768px){.mom-header{padding:12px 15px;flex-direction:column;gap:10px}.header-content{width:100%;justify-content:space-between}.lang-selector{width:100%;justify-content:center}.lang-select{min-width:110px;font-size:13px;padding:8px 12px;width:calc(50% - 20px)}.swap-btn{order:-1}.chat-container{padding:15px}.message{max-width:90%;padding:14px}.settings-panel{width:100%;right:-100%}.text-input-wrapper{padding:12px 15px}.text-input{font-size:16px}.send-btn{width:48px;height:48px;min-width:48px;min-height:48px;font-size:18px}.mode-toggle{margin-bottom:10px}.mode-btn{padding:8px 12px;font-size:13px}.vocabulary-list{gap:8px}.vocab-word{padding:6px 10px;font-size:13px}.preview-modal{padding:10px}.preview-content{padding:20px;max-height:90vh}.preview-actions{flex-direction:column}}@media (max-width:480px){.mom-title{font-size:16px}.mom-subtitle{font-size:11px}.lang-select{min-width:100px;font-size:12px;padding:6px 10px}.swap-btn{width:32px;height:32px;font-size:14px}.message-content{font-size:15px}.vocab-word{font-size:12px}.history-controls{grid-template-columns:1fr}.status-bar{font-size:11px;padding:8px 15px;min-width:180px}.send-btn{width:44px;height:44px;min-width:44px;min-height:44px}}@supports (padding:max(0px)){.input-area{padding-bottom:max(18px,env(safe-area-inset-bottom))}.settings-panel{padding-top:max(20px,env(safe-area-inset-top))}}::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-track{background:rgba(255,255,255,.05);border-radius:3px}::-webkit-scrollbar-thumb{background:linear-gradient(to bottom,var(--accent-a),var(--accent-b));border-radius:3px}::-webkit-scrollbar-thumb:hover{background:linear-gradient(to bottom,var(--accent-b),var(--accent-c))}button,input,select,textarea{font-size:16px}.action-btn,.message,.vocab-word{-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}.text-input{-webkit-user-select:text;user-select:text}body{overscroll-behavior-y:contain}</style><div class=auth-screen id=auth-screen><div class=auth-container><div class="auth-step active"id=activation-step><div class=auth-icon>â™¾ï¸</div><div class=auth-title>æ¬¢è¿ä½¿ç”¨ ZANOVA AI</div><div class=auth-subtitle>V1.0.0 (PSLD Free Edition)</div><div style=text-align:center;color:var(--text-secondary);font-size:14px>æˆ‘ä»¬æ­£åœ¨éªŒè¯æ‚¨çš„èº«ä»½, ä»¥è®©æ‚¨ä½¿ç”¨PSLD FREE å…è´¹ç‰ˆæœ¬...</div><div class=loading-spinner></div></div><div class=auth-step id=login-step><div class=auth-icon>â†’</div><div class=auth-title>ä½¿ç”¨å‰ï¼Œæˆ‘ä»¬éœ€è¦æ¿€æ´»æ‚¨çš„äº§å“</div><div class=auth-subtitle>æˆ‘ä»¬æ­£åœ¨å¸®æ‚¨æ¿€æ´»ï¼Œè¿™å¯èƒ½éœ€è¦ä¸€ç‚¹æ—¶é—´...</div><div style=text-align:center;color:var(--text-secondary);font-size:14px;margin-top:10px>äº§å“ä¿¡æ¯ï¼šZANOVA AI å¼€å‘è€…ï¼šZhanyi Zhou ç‰ˆæœ¬å·ï¼š1.0.0 PSLD Free</div><div class=loading-spinner style=margin-top:20px></div><div class=auth-code id=auth-code></div></div><div class=auth-indicator><div class="auth-dot active"id=auth-dot-0></div><div class=auth-dot id=auth-dot-1></div><div class=auth-dot id=auth-dot-2></div></div></div></div><div class="terms-screen hidden"id=terms-screen><div class=terms-header><div class=terms-title><span>ğŸ“‹</span>æ‚¨å¥½ï¼Œæ¬¢è¿ä½¿ç”¨ï¼</div><div class=terms-subtitle>V 1.0.0 PSLD FREE</div></div><div class=terms-content><div class=terms-section><div class=terms-section-title>æœåŠ¡æ€»è§ˆ</div><div class=terms-section-content>æ„Ÿè°¢æ‚¨ä½¿ç”¨Ashleyæ——ä¸‹çš„ZANOVA AIã€‚åœ¨åŸç¿»è¯‘å™¨çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬æ·»åŠ äº†æ‚¨æ‰€éœ€è¦çš„ç‰¹æ®ŠåŠŸèƒ½ï¼Œå·²å®ç°PSLD (Personalized) ç‰ˆæœ¬ã€‚æˆ‘ä»¬ä¸ºæ‚¨çš„ç‰ˆæœ¬åˆ¶ä½œäº†äº§å“ä½¿ç”¨è¯´æ˜ä¹¦ï¼Œå»ºè®®æ‚¨è®¤çœŸæŸ¥çœ‹ã€‚</div></div><div class=terms-section><div class=terms-section-title>ğŸ“Š ä¸»è¦åŠŸèƒ½</div><div class=terms-section-content>â€¢ AI é©±åŠ¨ç¿»è¯‘ï¼ˆDeepseekï¼‰<br>â€¢ å£ç¬”åŒæ¨¡å¼ç¿»è¯‘<br>â€¢ é«˜è¯­éŸ³è¯†åˆ«åº¦<br>â€¢ å¤šç§å¯è°ƒä¸ªæ€§åŒ–åŠŸèƒ½<br>â€¢ ç§»åŠ¨ç«¯ç”µè„‘ç«¯åŒé€‚é…<br>â€¢ å››è¯­è¨€ç¿»è¯‘<br></div></div><div class=terms-section><div class=terms-section-title>ğŸ” ç‰¹æ®ŠåŠŸèƒ½</div><div class=terms-section-content>â€¢ è‡ªåŠ¨å•è¯æå–ï¼Œå¯é€‰æ‹©ç­‰çº§<br>â€¢ å¯æœ—è¯»åŠŸèƒ½<br>â€¢ å¯æœ—è¯»åŠŸèƒ½<br>â€¢ æœªæ¥çš„æ‰‡è´è‹±è¯­å•è¯æœ¬å¯¼å‡ºåŠŸèƒ½<br>â€¢ å†å²è®°å½•<br>â€¢ å®šåˆ¶ DeepSeek AI<br></div></div><div class=terms-section><div class=terms-section-title>â€¼ï¸ é‡è¦ï¼ä½¿ç”¨é¡»çŸ¥ï¼š</div><div class=terms-section-content>åœ¨æ‚¨å‘é€ç¬¬ä¸€ä¸ªç¿»è¯‘æ¶ˆæ¯æ—¶ï¼Œä¼šè½¬åˆ°å¦ä¸€ä¸ªç½‘ç«™ä»¥è‡ªåŠ¨äººæœºéªŒè¯ï¼Œå«ä¸ºputer.comï¼Œå…¨ç¨‹è‡ªåŠ¨åŒ–ï¼Œä¹‹åä¼šè‡ªåŠ¨è¿”å›ç½‘ç«™ã€‚è¯·æ‚¨å¦‚æœæ‚¨ç¢°åˆ°ä»»ä½•é—®é¢˜ï¼Œæ¯”å¦‚é€Ÿåº¦è¿‡æ…¢ï¼ŒåŠ è½½å¤±è´¥ï¼Œå¡é¡¿ï¼ŒæŒ‰é’®å¤±æ•ˆï¼Œè¯·æŠ¥å‘Šå›¢é˜Ÿï¼Œä»¥ä¿®å¤ï¼šz03640940@gmail.com</div></div><div class=terms-section><div class=terms-section-title>ğŸ”„ æ›´æ–°</div><div class=terms-section-content>æ‚¨ä½¿ç”¨çš„ç‰ˆæœ¬ä¼šå®šæœŸæ›´æ–°ã€‚</div></div></div><div class=terms-actions><button class=terms-agree-btn id=agree-terms-btn>æ˜ç™½äº†ï¼Œç»§ç»­</button></div></div><div id=main-app style=display:flex;flex-direction:column;height:100%;flex:1><div class=mom-header><div class=header-content><div><div class=mom-title><span>â™¾ï¸</span>ZANOVA AI</div><div class=mom-subtitle>V 1.0.0 PSLD FREE</div></div><div class=lang-selector><select id=lang-select-a class=lang-select></select><button class=swap-btn id=swap-btn>â‡„</button><select id=lang-select-b class=lang-select></select></div></div><button class=settings-btn id=settings-btn>âš™ï¸</button></div><div class=settings-panel id=settings-panel><div class=panel-header><div class=panel-title><span>âš™ï¸</span>è®¾ç½®</div><button class=close-btn id=close-settings>Ã—</button></div><div class=setting-group><h3>ğŸ”¤ ç¿»è¯‘é£æ ¼</h3><div class=setting-item><label>ç¿»è¯‘éš¾åº¦</label><select id=difficulty class=level-select><option value=simple>Simple & Clear<option value=complex>Complex & Natural<option value=both>Both Styles</select></div></div><div class=setting-group><h3>ğŸ“š è¯æ±‡æå–è®¾ç½®</h3><div class=setting-item><label>è¯æ±‡ç­‰çº§</label><select id=vocab-level class=level-select><option value=middle_school>Middle School (ä¸­è€ƒ)<option value=high_school>High School (é«˜è€ƒ)<option value=cet4>CET-4 (å››çº§)<option value=cet6 selected>CET-6 (å…­çº§)<option value=ielts>IELTS (é›…æ€)<option value=toefl>TOEFL (æ‰˜ç¦)<option value=tem8>TEM-8 (å…«çº§)<option value=all>All Levelsï¼ˆæ‰€æœ‰ç­‰çº§ï¼‰</select></div><div class=setting-item><label style=display:flex;align-items:center;gap:8px><input type=checkbox id=auto-extract-vocab checked style=width:18px;height:18px><span>è‡ªåŠ¨å•è¯æå–</span></label></div></div><div class="setting-group shanbay-section"><h3>ğŸŒŸ æ‰‡è´è‹±è¯­å•è¯æœ¬å¯¼å‡º</h3><div class=setting-item><p style=font-size:13px;color:var(--text-secondary);margin-bottom:15px;line-height:1.5>âŒæœªæ¥åŠŸèƒ½âŒ</p><button class=shanbay-btn id=shanbay-export-btn><span>ğŸ“¤</span>âŒæœªæ¥åŠŸèƒ½âŒ</button><p style=font-size:12px;color:var(--text-secondary);margin-top:10px>âŒæœªæ¥åŠŸèƒ½âŒ</div></div><div class=setting-group><h3>ğŸ“– Hå†å²</h3><div class=setting-item><div style=display:flex;align-items:center;justify-content:space-between><span>æ˜¾ç¤ºå†å²è®°å½•</span><label class=switch><input type=checkbox id=show-history-toggle checked><span class=slider></span></label></div></div><div class=history-controls><button class=history-btn id=export-history><span>ğŸ’¾</span><span>å¯¼å‡º</span></button><button class="history-btn clear"id=clear-history><span>ğŸ—‘ï¸</span><span>æ¸…é™¤</span></button></div></div><div class=setting-group><h3>ğŸ¤– AI Model</h3><div class=setting-item><div style="color:var(--accent-a);font-size:14px;padding:12px;background:rgba(79,209,199,.1);border-radius:10px;border:1px solid rgba(79,209,199,.3)">ğŸ¯ Using DeepSeek AI - Optimized for Translation</div></div></div></div><div class=preview-modal id=preview-modal><div class=preview-content><div class=preview-header><div class=preview-title><span>ğŸ“‹</span>Preview Vocabulary Export</div><button class=close-btn id=close-preview>Ã—</button></div><div class=preview-subtitle>Select the words you want to export to Shanbay format (one word per line)</div><div class=select-all id=select-all><input type=checkbox id=select-all-checkbox checked><span>Select All</span></div><div class=vocab-preview-list id=vocab-preview-list></div><div class=preview-actions><button class="preview-btn confirm"id=confirm-export><span>ğŸ“¤</span>Export Selected Words</button><button class="preview-btn cancel"id=cancel-preview>Cancel</button></div></div></div><div class=chat-container id=chat-container><div class=empty-state id=empty-state><div class=empty-state-icon>ğŸ’¬</div><div class=empty-state-text>Start translating between languages using text or voice input</div></div></div><div class=input-area><div class=mode-toggle><button class="mode-btn active"id=text-mode-btn><span>âŒ¨ï¸</span><span>Text</span></button><button class=mode-btn id=voice-mode-btn><span>ğŸ¤</span><span>Voice</span></button></div><div class=input-container><div class=text-input-wrapper><textarea class=text-input id=text-input placeholder="Type or speak to translate..."rows=1></textarea><button class=voice-btn id=voice-toggle-btn>ğŸ¤</button></div><button class=send-btn id=send-btn type=button>â†’</button></div></div></div><div class=status-bar id=status-bar><div class=status-dot id=status-dot></div><span id=status-text>Ready</span></div><script src=https://js.puter.com/v2/ ></script><script>const APP_CONFIG={name:"AI Translator",version:"2.1.0",description:"Professional Translation Tool"},LANGUAGES=[{code:"zh-CN",name:"Chinese",label:"ä¸­æ–‡",flag:"ğŸ‡¨ğŸ‡³"},{code:"en-US",name:"English",label:"English",flag:"ğŸ‡ºğŸ‡¸"},{code:"fr-FR",name:"French",label:"FranÃ§ais",flag:"ğŸ‡«ğŸ‡·"},{code:"es-ES",name:"Spanish",label:"EspaÃ±ol",flag:"ğŸ‡ªğŸ‡¸"}],VOCAB_LEVELS={middle_school:{name:"Middle School",cn:"ä¸­è€ƒ",difficulty:"basic",emoji:"ğŸ“š"},high_school:{name:"High School",cn:"é«˜è€ƒ",difficulty:"basic",emoji:"ğŸ“"},cet4:{name:"CET-4",cn:"å››çº§",difficulty:"intermediate",emoji:"â­"},cet6:{name:"CET-6",cn:"å…­çº§",difficulty:"intermediate",emoji:"â­â­"},ielts:{name:"IELTS",cn:"é›…æ€",difficulty:"advanced",emoji:"ğŸŒ"},toefl:{name:"TOEFL",cn:"æ‰˜ç¦",difficulty:"advanced",emoji:"ğŸ‡ºğŸ‡¸"},tem8:{name:"TEM-8",cn:"å…«çº§",difficulty:"advanced",emoji:"ğŸ¯"},all:{name:"All Levels",cn:"å…¨éƒ¨",difficulty:"mixed",emoji:"ğŸŒŸ"}};let state={sourceLang:"zh-CN",targetLang:"en-US",isRecording:!1,inputMode:"text",difficulty:"simple",vocabLevel:"cet6",autoExtractVocab:!0,showHistory:!0,isTranslating:!1,conversationHistory:[],currentSessionMessages:[],speechTimeout:null,allVocabulary:[],authCompleted:!1};const elements={authScreen:document.getElementById("auth-screen"),activationStep:document.getElementById("activation-step"),loginStep:document.getElementById("login-step"),authCode:document.getElementById("auth-code"),authDot0:document.getElementById("auth-dot-0"),authDot1:document.getElementById("auth-dot-1"),authDot2:document.getElementById("auth-dot-2"),termsScreen:document.getElementById("terms-screen"),agreeTermsBtn:document.getElementById("agree-terms-btn"),mainApp:document.getElementById("main-app"),langSelectA:document.getElementById("lang-select-a"),langSelectB:document.getElementById("lang-select-b"),swapBtn:document.getElementById("swap-btn"),settingsBtn:document.getElementById("settings-btn"),settingsPanel:document.getElementById("settings-panel"),closeSettings:document.getElementById("close-settings"),difficultySelect:document.getElementById("difficulty"),vocabLevelSelect:document.getElementById("vocab-level"),autoExtractVocabCheckbox:document.getElementById("auto-extract-vocab"),showHistoryToggle:document.getElementById("show-history-toggle"),shanbayExportBtn:document.getElementById("shanbay-export-btn"),previewModal:document.getElementById("preview-modal"),closePreview:document.getElementById("close-preview"),vocabPreviewList:document.getElementById("vocab-preview-list"),selectAllCheckbox:document.getElementById("select-all-checkbox"),selectAllContainer:document.getElementById("select-all"),confirmExportBtn:document.getElementById("confirm-export"),cancelPreviewBtn:document.getElementById("cancel-preview"),exportHistoryBtn:document.getElementById("export-history"),clearHistoryBtn:document.getElementById("clear-history"),chatContainer:document.getElementById("chat-container"),emptyState:document.getElementById("empty-state"),textModeBtn:document.getElementById("text-mode-btn"),voiceModeBtn:document.getElementById("voice-mode-btn"),textInput:document.getElementById("text-input"),voiceToggleBtn:document.getElementById("voice-toggle-btn"),sendBtn:document.getElementById("send-btn"),statusBar:document.getElementById("status-bar"),statusDot:document.getElementById("status-dot"),statusText:document.getElementById("status-text")};let recognition=null,finalTranscript="";function startAuthFlow(){console.log("Starting authentication flow..."),setTimeout((()=>{elements.authDot1.classList.add("active"),elements.activationStep.classList.remove("active"),elements.loginStep.classList.add("active");const e=Math.random().toString(36).substring(2,10).toUpperCase();elements.authCode.textContent=e,setTimeout((()=>{elements.authDot2.classList.add("active"),setTimeout((()=>{redirectToTerms()}),7500)}),2e3)}),2e3)}function redirectToTerms(){elements.authScreen.classList.add("hidden"),elements.termsScreen.classList.remove("hidden"),elements.mainApp.style.display="none"}function init(){console.log(`Initializing ${APP_CONFIG.name}`),loadHistory(),setupLanguageSelectors(),setupEventListeners(),initSpeechRecognition(),updateUI(),renderMessages(),console.log("Application initialized successfully")}function loadHistory(){try{const e=localStorage.getItem("translationHistory");if(e){const t=JSON.parse(e);Array.isArray(t)&&(state.conversationHistory=t.map((e=>({...e,timestamp:new Date(e.timestamp)}))),state.allVocabulary=[],state.conversationHistory.forEach((e=>{e.vocabulary&&Array.isArray(e.vocabulary)&&state.allVocabulary.push(...e.vocabulary)})))}}catch(e){console.error("Failed to load history:",e)}}function saveHistory(){try{localStorage.setItem("translationHistory",JSON.stringify(state.conversationHistory))}catch(e){console.error("Failed to save history:",e)}}function setupLanguageSelectors(){LANGUAGES.forEach((e=>{const t=new Option(`${e.flag} ${e.name}`,e.code),n=new Option(`${e.flag} ${e.name}`,e.code);elements.langSelectA.add(t),elements.langSelectB.add(n)})),elements.langSelectA.value=state.sourceLang,elements.langSelectB.value=state.targetLang}function setupEventListeners(){elements.langSelectA.addEventListener("change",(e=>{state.sourceLang=e.target.value,updateUI(),updateStatus("Language changed","success")})),elements.langSelectB.addEventListener("change",(e=>{state.targetLang=e.target.value,updateUI(),updateStatus("Language changed","success")})),elements.swapBtn.addEventListener("click",(()=>{[state.sourceLang,state.targetLang]=[state.targetLang,state.sourceLang],elements.langSelectA.value=state.sourceLang,elements.langSelectB.value=state.targetLang,updateUI(),updateStatus("Languages swapped","success")})),elements.settingsBtn.addEventListener("click",(()=>{elements.settingsPanel.classList.add("active")})),elements.closeSettings.addEventListener("click",(()=>{elements.settingsPanel.classList.remove("active")})),elements.difficultySelect.addEventListener("change",(e=>{state.difficulty=e.target.value,updateStatus("Translation style updated","success")})),elements.vocabLevelSelect.addEventListener("change",(e=>{state.vocabLevel=e.target.value,updateStatus(`Vocabulary level: ${VOCAB_LEVELS[state.vocabLevel]?.name}`,"success")})),elements.autoExtractVocabCheckbox.addEventListener("change",(e=>{state.autoExtractVocab=e.target.checked,updateStatus("Auto-extract vocabulary: "+(state.autoExtractVocab?"ON":"OFF"),"success")})),elements.showHistoryToggle.addEventListener("change",(e=>{state.showHistory=e.target.checked,renderMessages(),updateStatus("History: "+(state.showHistory?"ON":"OFF"),"success")})),elements.shanbayExportBtn.addEventListener("click",previewShanbayExport),elements.closePreview.addEventListener("click",(()=>{elements.previewModal.classList.remove("active")})),elements.cancelPreviewBtn.addEventListener("click",(()=>{elements.previewModal.classList.remove("active")})),elements.confirmExportBtn.addEventListener("click",exportToShanbay),elements.selectAllCheckbox.addEventListener("change",(e=>{elements.vocabPreviewList.querySelectorAll('input[type="checkbox"]').forEach((t=>{t.checked=e.target.checked}))})),elements.exportHistoryBtn.addEventListener("click",exportHistory),elements.clearHistoryBtn.addEventListener("click",clearHistory),elements.textModeBtn.addEventListener("click",(()=>setInputMode("text"))),elements.voiceModeBtn.addEventListener("click",(()=>{recognition?setInputMode("voice"):updateStatus("Voice input not supported","error")})),elements.textInput.addEventListener("input",autoResizeTextarea),elements.textInput.addEventListener("keypress",(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),handleSend())})),elements.sendBtn.addEventListener("click",handleSend),elements.sendBtn.addEventListener("touchend",(e=>{e.cancelable&&e.preventDefault()})),elements.voiceToggleBtn.addEventListener("click",toggleVoiceRecording),document.addEventListener("click",(e=>{elements.settingsPanel.contains(e.target)||elements.settingsBtn.contains(e.target)||elements.settingsPanel.classList.remove("active")})),setTimeout((()=>{elements.textInput.focus()}),500)}function isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function initSpeechRecognition(){if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const e=window.SpeechRecognition||window.webkitSpeechRecognition;try{recognition=new e,recognition.continuous=!1,recognition.interimResults=!0,recognition.onstart=function(){state.isRecording=!0,finalTranscript="",updateUI(),updateStatus("ğŸ¤ Listening...","error")},recognition.onresult=function(e){let t="";for(let n=e.resultIndex;n<e.results.length;++n)e.results[n].isFinal?finalTranscript+=e.results[n][0].transcript:t+=e.results[n][0].transcript;elements.textInput.value=finalTranscript+t,autoResizeTextarea(),clearTimeout(state.speechTimeout),state.speechTimeout=setTimeout((()=>{state.isRecording&&recognition.stop()}),2e3)},recognition.onend=function(){state.isRecording=!1,clearTimeout(state.speechTimeout),finalTranscript.trim()&&setTimeout((()=>{handleSend()}),300),updateUI()},recognition.onerror=function(e){state.isRecording=!1,clearTimeout(state.speechTimeout),"no-speech"!==e.error&&updateStatus("Voice input error","error"),updateUI()},elements.voiceToggleBtn.style.display="flex"}catch(e){console.error("Failed to initialize speech recognition:",e),elements.voiceToggleBtn.style.display="none"}}}function setInputMode(e){state.inputMode=e,"text"===e?(elements.textModeBtn.classList.add("active"),elements.voiceModeBtn.classList.remove("active"),elements.textInput.focus()):(elements.textModeBtn.classList.remove("active"),elements.voiceModeBtn.classList.add("active")),updateUI(),updateStatus(`${e.charAt(0).toUpperCase()+e.slice(1)} mode`,"success")}function toggleVoiceRecording(){if(recognition)if(state.isRecording)recognition.stop();else{finalTranscript="",elements.textInput.value="",autoResizeTextarea(),recognition.lang=state.sourceLang;try{recognition.start()}catch(e){console.error("Failed to start speech recognition:",e),updateStatus("Cannot start voice input","error")}}}function autoResizeTextarea(){const e=elements.textInput;e.style.height="auto",e.style.height=Math.min(e.scrollHeight,120)+"px"}async function handleSend(){const e=elements.textInput.value.trim();if(!e||state.isTranslating)return;state.isTranslating=!0,updateUI(),updateStatus("Translating...","translating"),elements.emptyState.style.display="none";addMessage({type:"user",text:e,sourceLang:state.sourceLang,targetLang:state.targetLang,timestamp:new Date,id:Date.now()+Math.random()}),elements.textInput.value="",autoResizeTextarea();try{const t=LANGUAGES.find((e=>e.code===state.sourceLang)),n=LANGUAGES.find((e=>e.code===state.targetLang)),a=await translateText(e,t,n);let s=null;if(state.autoExtractVocab&&"zh-CN"===state.sourceLang&&"en-US"===state.targetLang)try{s=await extractVocabulary(e,a.translatedText),s&&s.length>0&&state.allVocabulary.push(...s)}catch(e){console.warn("Vocabulary extraction failed:",e)}addMessage({type:"ai",text:a.translatedText,originalText:e,sourceLang:state.sourceLang,targetLang:state.targetLang,vocabulary:s,timestamp:new Date,id:Date.now()+Math.random()}),updateStatus("âœ… Complete","success"),setTimeout((()=>{elements.chatContainer.scrollTop=elements.chatContainer.scrollHeight}),100),saveHistory()}catch(e){console.error("Translation error:",e),updateStatus("âŒ Translation failed","error");addMessage({type:"ai",text:"Translation error. Please try again.",isError:!0,timestamp:new Date,id:Date.now()+Math.random()})}state.isTranslating=!1,updateUI()}async function translateText(e,t,n){let a="";switch(state.difficulty){case"simple":a="Translate into simple, clear sentences. Use basic vocabulary and straightforward grammar.";break;case"complex":a="Translate into complex, natural sentences with rich vocabulary and sophisticated expressions.";break;case"both":a='Provide two translations separated by "||": 1) Simple version 2) Complex natural version';break;default:a="Translate naturally and accurately."}const s=`You are a professional translator. Translate the following text from ${t.name} to ${n.name}.\n\n${a}\n\nOriginal text: "${e}"\n\nIMPORTANT: Output ONLY the translated text. Do not include any explanations or additional text.`;try{const e=await puter.ai.chat(s,{model:"deepseek-chat",max_tokens:2048});let a=("string"==typeof e?e:e.message.content).trim();if(a=a.replace(/```[\s\S]*?```/g,""),a=a.replace(/`/g,""),"both"===state.difficulty){const e=a.split("||").map((e=>e.trim())).filter((e=>e));e.length>=2&&(a=`ğŸ“ Simple:\n${e[0]}\n\nğŸ¯ Advanced:\n${e[1]}`)}return{translatedText:a,sourceLang:t,targetLang:n}}catch(e){throw console.error("Translation API error:",e),new Error("Translation service error")}}async function extractVocabulary(e,t){const n=VOCAB_LEVELS[state.vocabLevel];if(!n)return null;const a=`Extract 3-5 important English vocabulary words from this translation:\n\nChinese: "${e}"\nEnglish: "${t}"\n\nTarget level: ${n.name}\n\nFor each word, provide:\n- word: the English word\n- pronunciation: pronunciation guide\n- definition: brief definition\n- example: example sentence\n- difficulty: basic, intermediate, or advanced\n\nFormat as a JSON array. Output ONLY the JSON array.`;try{const e=await puter.ai.chat(a,{model:"deepseek-chat",max_tokens:1024}),t="string"==typeof e?e:e.message.content;try{const e=t.match(/\[[\s\S]*?\]/);if(e){let t=JSON.parse(e[0]);return Array.isArray(t)||(t=[t]),t.filter((e=>e&&e.word)).map((e=>({word:e.word.trim(),pronunciation:e.pronunciation||"",definition:e.definition||"",example:e.example||"",difficulty:e.difficulty||"intermediate",language:"english"}))).slice(0,5)}}catch(e){console.warn("Vocabulary parse error:",e)}}catch(e){console.warn("Vocabulary extraction error:",e)}return null}function addMessage(e){state.conversationHistory.push(e),state.currentSessionMessages.push(e),renderMessages()}function renderMessages(){elements.chatContainer.innerHTML="";let e=state.showHistory?state.conversationHistory:state.currentSessionMessages;if(0===e.length)return void(elements.emptyState.style.display="flex");elements.emptyState.style.display="none";[...e].sort(((e,t)=>new Date(e.timestamp)-new Date(t.timestamp))).forEach((e=>renderMessage(e))),setTimeout((()=>{elements.chatContainer.scrollTop=elements.chatContainer.scrollHeight}),100)}function renderMessage(e){const t=document.createElement("div");t.className=`message ${e.type}`,t.dataset.id=e.id;const n=LANGUAGES.find((t=>t.code===e.sourceLang)),a=LANGUAGES.find((t=>t.code===e.targetLang)),s=e.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});let o="";o="user"===e.type?`\n                    <div class="message-header">\n                        <span>${n?.flag||""} Input</span>\n                        <span class="lang-badge source">TEXT</span>\n                    </div>\n                `:`\n                    <div class="message-header">\n                        <span>${a?.flag||""} Translation</span>\n                        <div class="message-actions">\n                            <button class="action-btn speak-btn" data-text="${e.text.replace(/"/g,"&quot;")}" title="Read">\n                                ğŸ”Š\n                            </button>\n                            <span class="lang-badge target">AI</span>\n                        </div>\n                    </div>\n                `;let i="";if(e.isError)i=`<div class="message-content">âŒ ${e.text}</div>`;else if(i=`<div class="message-content">${e.text}</div>`,e.vocabulary&&Array.isArray(e.vocabulary)&&e.vocabulary.length>0){const t=e.vocabulary.filter((e=>"english"===e.language&&e.word));if(t.length>0){const e=t.map((e=>{const t=e.difficulty||"basic",n="basic"===t?"ğŸ“š":"intermediate"===t?"â­":"ğŸ¯",a=`\n                                <strong>${e.word}</strong><br>\n                                ${e.pronunciation?`<em>${e.pronunciation}</em><br>`:""}\n                                ${e.definition||""}<br>\n                                "${e.example||""}"\n                            `;return`\n                                <div class="vocab-word difficulty-${t} tooltip">\n                                    ${n} ${e.word}\n                                    <span class="level-tag level-${t}">${t}</span>\n                                    <div class="tooltip-text">${a}</div>\n                                </div>\n                            `})).join(""),n=VOCAB_LEVELS[state.vocabLevel];i+=`\n                            <div class="vocabulary-section">\n                                <div class="vocabulary-title">\n                                    <span>ğŸ“š</span>\n                                    Vocabulary (${n.emoji} ${n.name})\n                                </div>\n                                <div class="vocabulary-list">\n                                    ${e}\n                                </div>\n                            </div>\n                        `}}if(t.innerHTML=`\n                ${o}\n                ${i}\n                <div class="message-time">${s}</div>\n            `,elements.chatContainer.appendChild(t),"ai"===e.type){const n=t.querySelector(".speak-btn");n&&n.addEventListener("click",(()=>{speakText(e.text,e.targetLang||state.targetLang)}))}}function speakText(e,t){window.speechSynthesis.cancel();const n=e.replace(/[ğŸ“ğŸ¯]\s*(Simple|Advanced|Translation):\s*/gi,"").replace(/[\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{1F1E0}-\u{1F1FF}]/gu,"").replace(/\n/g,". ").trim();if(!n)return;const a=new SpeechSynthesisUtterance(n);a.lang=t,a.rate=.9,a.pitch=1,a.volume=1,a.onstart=()=>{updateStatus("ğŸ”Š Reading...","translating")},a.onend=()=>{updateStatus("Complete","success")},window.speechSynthesis.speak(a)}function previewShanbayExport(){const e=new Set,t=[];state.allVocabulary.forEach((n=>{if("english"===n.language&&n.word){const a=n.word.toLowerCase().trim();e.has(a)||(e.add(a),t.push({word:n.word.trim(),difficulty:n.difficulty||"basic",selected:!0}))}})),0!==t.length?(elements.vocabPreviewList.innerHTML="",t.forEach(((e,t)=>{const n=document.createElement("div");n.className="vocab-preview-item",n.innerHTML=`\n                    <input type="checkbox" id="vocab-${t}" data-word="${e.word.replace(/"/g,"&quot;")}" checked>\n                    <label for="vocab-${t}" class="vocab-word-preview">${e.word}</label>\n                    <span class="vocab-difficulty level-${e.difficulty}">${e.difficulty}</span>\n                `,elements.vocabPreviewList.appendChild(n)})),elements.selectAllCheckbox.checked=!0,elements.previewModal.classList.add("active"),updateStatus("Previewing vocabulary","success")):updateStatus("No vocabulary found","error")}function exportToShanbay(){const e=elements.vocabPreviewList.querySelectorAll('input[type="checkbox"]:checked'),t=Array.from(e).map((e=>e.dataset.word.trim()));if(0===t.length)return void updateStatus("No words selected","error");const n=t.join("\n"),a=new Blob([n],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(a),o=document.createElement("a");o.href=s,o.download=`vocabulary-${(new Date).toISOString().split("T")[0]}.txt`,document.body.appendChild(o),o.click(),setTimeout((()=>{document.body.removeChild(o),URL.revokeObjectURL(s)}),100),elements.previewModal.classList.remove("active"),updateStatus(`âœ… Exported ${t.length} words`,"success")}function exportHistory(){try{const e={app:APP_CONFIG.name,exportedAt:(new Date).toISOString(),translations:state.conversationHistory,vocabulary:state.allVocabulary},t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json;charset=utf-8"}),a=URL.createObjectURL(n),s=document.createElement("a");s.href=a,s.download=`translator-export-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(s),s.click(),setTimeout((()=>{document.body.removeChild(s),URL.revokeObjectURL(a)}),100),updateStatus("âœ… Exported successfully","success")}catch(e){console.error("Export failed:",e),updateStatus("âŒ Export failed","error")}}function clearHistory(){confirm("Clear all translation history? This cannot be undone.")&&(state.conversationHistory=[],state.currentSessionMessages=[],state.allVocabulary=[],saveHistory(),renderMessages(),updateStatus("ğŸ—‘ï¸ History cleared","success"))}function updateStatus(e,t="info"){switch(elements.statusText.textContent=e,t){case"success":elements.statusDot.style.background="var(--success)",elements.statusBar.style.borderColor="var(--success)";break;case"error":elements.statusDot.style.background="var(--error)",elements.statusBar.style.borderColor="var(--error)";break;case"translating":elements.statusDot.style.background="var(--warning)",elements.statusBar.style.borderColor="var(--warning)";break;default:elements.statusDot.style.background="var(--accent-a)",elements.statusBar.style.borderColor="var(--accent-a)"}"error"!==t&&"translating"!==t&&(clearTimeout(window.statusTimeout),window.statusTimeout=setTimeout((()=>{state.isRecording||state.isTranslating||(elements.statusText.textContent="Ready",elements.statusDot.style.background="var(--accent-a)",elements.statusBar.style.borderColor="var(--accent-a)")}),3e3))}function updateUI(){elements.sendBtn.disabled=state.isTranslating||state.isRecording,elements.voiceToggleBtn.disabled=state.isTranslating;const e=state.allVocabulary.filter((e=>"english"===e.language)).length;elements.shanbayExportBtn.disabled=0===e,state.isRecording?(elements.voiceToggleBtn.classList.add("recording"),elements.voiceToggleBtn.innerHTML="â—",elements.statusDot.classList.add("recording")):(elements.voiceToggleBtn.classList.remove("recording"),elements.voiceToggleBtn.innerHTML="ğŸ¤",elements.statusDot.classList.remove("recording")),state.isTranslating?elements.sendBtn.innerHTML='<div class="loading-dots"><span></span><span></span><span></span></div>':elements.sendBtn.innerHTML="â†’",e>0&&(elements.shanbayExportBtn.innerHTML=`<span>ğŸ“¤</span> Export ${e} Words`)}elements.agreeTermsBtn.addEventListener("click",(()=>{elements.termsScreen.classList.add("hidden"),elements.mainApp.style.display="flex",state.authCompleted=!0,localStorage.setItem("authCompleted","true"),init()}));const authCompleted=localStorage.getItem("authCompleted");authCompleted?(elements.authScreen.classList.add("hidden"),elements.termsScreen.classList.add("hidden"),state.authCompleted=!0,init()):startAuthFlow()</script>